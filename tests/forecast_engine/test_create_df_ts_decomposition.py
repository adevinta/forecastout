from forecastout.forecast_engine.decompose_time_series \
    import create_df_ts_decomposition
import pandas as pd


def test_create_df_ts_decomposition():
    output_df = create_df_ts_decomposition(input_df())
    for col in ["seasonal", "trend", "residual"]:
        output_df[col] = output_df[col].round(6)
    pd.testing.assert_frame_equal(
        output_df,
        expected_df()
    )


def input_df():
    date_list = [
        "2021-01-01",
        "2021-02-01",
        "2021-03-01",
        "2021-04-01",
        "2021-05-01",
        "2021-06-01",
        "2021-07-01",
        "2021-08-01",
        "2021-09-01",
        "2021-10-01",
        "2021-11-01",
        "2021-12-01",
        "2022-01-01",
        "2022-02-01",
        "2022-03-01",
        "2022-04-01",
        "2022-05-01",
        "2022-06-01",
        "2022-07-01",
        "2022-08-01",
        "2022-09-01",
        "2022-10-01",
        "2022-11-01",
        "2022-12-01",
        "2023-01-01",
        "2023-02-01",
        "2023-03-01",
        "2023-04-01",
        "2023-05-01",
        "2023-06-01",
        "2023-07-01",
        "2023-08-01",
        "2023-09-01",
        "2023-10-01",
        "2023-11-01",
        "2023-12-01"
    ]
    value_list = [
        5.830303e+06,
        7.400458e+06,
        7.449702e+06,
        6.480788e+06,
        6.995587e+06,
        1.675807e+06,
        8.372645e+06,
        1.132437e+07,
        1.799333e+06,
        1.270220e+07,
        4.509435e+06,
        1.331609e+07,
        1.282667e+07,
        1.547368e+07,
        1.489940e+07,
        1.246305e+07,
        1.299181e+07,
        3.016453e+06,
        1.465213e+07,
        1.931805e+07,
        2.998889e+06,
        2.072463e+07,
        7.215096e+06,
        2.092528e+07,
        1.982303e+07,
        2.354691e+07,
        2.234911e+07,
        1.844532e+07,
        1.898802e+07,
        4.357098e+06,
        2.093161e+07,
        2.731172e+07,
        4.198445e+06,
        2.874707e+07,
        9.920758e+06,
        2.853447e+07
    ]
    test_list = [0*i for i in range(len(date_list))]
    return pd.DataFrame({
        'date': date_list,
        'value': value_list,
        'test': test_list
    })


def expected_df():
    date_list = [
        "2021-01-01",
        "2021-02-01",
        "2021-03-01",
        "2021-04-01",
        "2021-05-01",
        "2021-06-01",
        "2021-07-01",
        "2021-08-01",
        "2021-09-01",
        "2021-10-01",
        "2021-11-01",
        "2021-12-01",
        "2022-01-01",
        "2022-02-01",
        "2022-03-01",
        "2022-04-01",
        "2022-05-01",
        "2022-06-01",
        "2022-07-01",
        "2022-08-01",
        "2022-09-01",
        "2022-10-01",
        "2022-11-01",
        "2022-12-01",
        "2023-01-01",
        "2023-02-01",
        "2023-03-01",
        "2023-04-01",
        "2023-05-01",
        "2023-06-01",
        "2023-07-01",
        "2023-08-01",
        "2023-09-01",
        "2023-10-01",
        "2023-11-01",
        "2023-12-01"
    ]
    seasonal_list = [
        9.936065e+05,
        2.080092e+06,
        1.645666e+06,
        1.930825e+05,
        2.242125e+05,
        -5.579238e+06,
        6.339306e+05,
        3.101989e+06,
        -6.906720e+06,
        3.512472e+06,
        -5.163958e+06,
        3.159024e+06,
        2.185934e+06,
        4.349283e+06,
        3.291333e+06,
        3.713124e+05,
        4.163946e+05,
        -1.004263e+07,
        1.109378e+06,
        5.291628e+06,
        -1.151120e+07,
        5.730875e+06,
        -8.262332e+06,
        4.964181e+06,
        3.378262e+06,
        6.618474e+06,
        4.936999e+06,
        5.495424e+05,
        6.085768e+05,
        -1.450602e+07,
        1.584826e+06,
        7.481267e+06,
        -1.611568e+07,
        7.949279e+06,
        -1.136071e+07,
        6.769338e+06
    ]
    trend_list = [
        4.836696e+06,
        5.320366e+06,
        5.804036e+06,
        6.287705e+06,
        6.771375e+06,
        7.255045e+06,
        7.738714e+06,
        8.222384e+06,
        8.706054e+06,
        9.189723e+06,
        9.673393e+06,
        1.015706e+07,
        1.064073e+07,
        1.112440e+07,
        1.160807e+07,
        1.209174e+07,
        1.257541e+07,
        1.305908e+07,
        1.354275e+07,
        1.402642e+07,
        1.451009e+07,
        1.499376e+07,
        1.547743e+07,
        1.596110e+07,
        1.644477e+07,
        1.692844e+07,
        1.741211e+07,
        1.789578e+07,
        1.837945e+07,
        1.886312e+07,
        1.934679e+07,
        1.983046e+07,
        2.031413e+07,
        2.079779e+07,
        2.128146e+07,
        2.176513e+07
    ]
    residual_list = [
        -1.169034,
        1.113754,
        1.737678,
        1.150498,
        -1.986819,
        -0.186823,
        -0.772035,
        -1.499578,
        0.020542,
        1.536937,
        0.200515,
        0.044226,
        2.400786,
        -2.487256,
        -3.819620,
        -2.556303,
        4.172059,
        0.318950,
        1.577402,
        3.138042,
        -0.120020,
        -3.371392,
        -0.509118,
        -0.174781,
        -1.148283,
        1.135245,
        1.760762,
        1.175738,
        -1.959206,
        -0.156945,
        -0.741029,
        -1.466419,
        0.056347,
        1.575675,
        0.242108,
        0.088145
    ]

    return pd.DataFrame({
            'date': pd.to_datetime(date_list),
            'seasonal': seasonal_list,
            'trend': trend_list,
            'residual': residual_list
    })
